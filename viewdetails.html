<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details | The Nemi Mart</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --blue: #1a2332; --orange: #e68a00; --light: #f4f7f6; --text-gray: #4a4a4a; --green: #27ae60; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #fff; color: var(--text-gray); }
        
        header { background: white; padding: 10px 5%; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #f0f0f0; position: sticky; top: 0; z-index: 1000; }
        .logo-box { display: flex; align-items: center; gap: 12px; cursor: pointer; text-decoration: none; }
        .logo-img { width: 40px; height: 40px; border-radius: 50%; }
        .logo-text h1 { margin: 0; font-size: 1rem; color: var(--blue); font-weight: 800; }

        .container { padding: 40px 5%; max-width: 1200px; margin: 0 auto; }
        .detail-wrapper { display: flex; flex-wrap: wrap; gap: 50px; align-items: flex-start; }
        
        .product-image { flex: 1; min-width: 320px; text-align: center; }
        .product-image img { width: 100%; max-width: 500px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); background: #f9f9f9; }
        
        .product-info { flex: 1; min-width: 320px; }
        .category-tag { color: var(--orange); font-weight: bold; text-transform: uppercase; font-size: 14px; letter-spacing: 1px; }
        .price { font-size: 2.5rem; font-weight: 800; color: var(--blue); margin: 15px 0; }
        
        /* Description Box */
        .desc-container { margin: 25px 0; padding-top: 20px; border-top: 1px solid #eee; }
        .desc-title { font-weight: 800; color: var(--blue); margin-bottom: 10px; display: block; font-size: 1.1rem; }
        .description { line-height: 1.8; color: var(--text-gray); white-space: pre-wrap; font-size: 1rem; }
        
        .btn-group { display: flex; gap: 15px; margin-top: 30px; }
        .buy-now { background: var(--blue); color: white; border: none; padding: 18px 30px; border-radius: 12px; cursor: pointer; font-weight: bold; flex: 1; font-size: 1rem; transition: 0.3s; }
        .buy-now:hover { background: var(--orange); }
        .whatsapp-btn { background: #25D366; color: white; border: none; padding: 18px 30px; border-radius: 12px; cursor: pointer; text-decoration: none; text-align: center; flex: 1; font-weight: bold; font-size: 1rem; display: flex; align-items: center; justify-content: center; gap: 10px; transition: 0.3s; }
        .whatsapp-btn:hover { background: #128C7E; }

        footer { background: var(--blue); color: white; padding: 40px 10%; margin-top: 60px; text-align: center; }
        #loading { text-align: center; padding: 100px 0; }

        @media (max-width: 768px) { .container { padding: 20px; } .price { font-size: 2rem; } .btn-group { flex-direction: column; } }
    </style>
</head>
<body>

<header>
    <a href="index.html" class="logo-box">
        <img src="logo.png" class="logo-img">
        <div class="logo-text"><h1>THE NEMI MART</h1></div>
    </a>
</header>

<div id="loading">
    <i class="fas fa-spinner fa-spin fa-3x" style="color: var(--orange);"></i>
    <h2 style="margin-top:20px;">Fetching Purity...</h2>
</div>

<div class="container" id="product-container" style="display:none;">
    <div class="detail-wrapper">
        <div class="product-image" id="img-box"></div>
        <div class="product-info">
            <div class="category-tag" id="p-cat"></div>
            <h1 id="p-name" style="color:var(--blue); margin:10px 0; font-size: 2rem;"></h1>
            
            <div style="color: var(--green); font-weight: 600;">
                <i class="fas fa-shield-alt"></i> 100% Pure & Organic
            </div>

            <div class="price" id="p-price"></div>
            
            <div class="desc-container">
                <span class="desc-title">Product Description</span>
                <div class="description" id="p-desc"></div>
            </div>
            
            <div class="btn-group">
                <button class="buy-now" id="add-to-cart-btn">
                    <i class="fas fa-shopping-cart"></i> ADD TO CART
                </button>
                <a href="#" class="whatsapp-btn" id="wa-btn">
                    <i class="fab fa-whatsapp"></i> ORDER ON WHATSAPP
                </a>
            </div>
        </div>
    </div>
</div>

<footer>
    <p>&copy; 2026 The Nemi Mart - Purity in Every Purchase</p>
    <p><i class="fas fa-envelope"></i> thenemimart@gmail.com</p>
</footer>

<script>
    const _supabase = supabase.createClient("https://rzmftpafcyxburlkwqnm.supabase.co", "sb_publishable_zt4Wt4wBgarEU15zF-RoKw_4achnceD");
    
    // Google Drive Image Link Fix
    function fixGDriveLink(link) {
        if (!link) return 'https://via.placeholder.com/500';
        if (link.includes('drive.google.com')) {
            const id = link.split('id=')[1] || link.split('/d/')[1].split('/')[0];
            return `https://lh3.googleusercontent.com/d/${id}`;
        }
        return link;
    }

    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('id');

    async function loadDetails() {
        if(!productId) {
            window.location.href = 'index.html';
            return;
        }

        const { data, error } = await _supabase
            .from('products')
            .select('*')
            .eq('id', productId)
            .single();

        if(error || !data) {
            document.getElementById('loading').innerHTML = "<h1>Product not found!</h1><a href='index.html'>Go Back Home</a>";
            return;
        }

        // Data Fill Logic
        document.title = `${data.name} | The Nemi Mart`;
        document.getElementById('p-name').innerText = data.name;
        document.getElementById('p-cat').innerText = data.category || 'Pure Product';
        document.getElementById('p-price').innerText = "₹" + data.price;
        
        // Admin se aaya description yahan show hoga
        document.getElementById('p-desc').innerText = data.description || "No description provided for this product. Rest assured, it meets all our purity standards.";
        
        document.getElementById('img-box').innerHTML = `<img src="${fixGDriveLink(data.image_url)}" alt="${data.name}">`;
        
        // WhatsApp Link Setup (Replace with your actual number)
        const waNumber = "91XXXXXXXXXX"; // Apna number yahan dalein
        document.getElementById('wa-btn').href = `https://wa.me/${waNumber}?text=Hi, I'm interested in buying: *${data.name}* (Price: ₹${data.price}). Please provide more details.`;

        // Add to Cart Logic
        document.getElementById('add-to-cart-btn').onclick = () => {
            let cart = JSON.parse(localStorage.getItem('nemi_cart')) || [];
            cart.push({ name: data.name, price: data.price });
            localStorage.setItem('nemi_cart', JSON.stringify(cart));
            
            // Notification toast ya alert
            alert(`${data.name} added to cart!`);
        };

        // Hide loader and show content
        document.getElementById('loading').style.display = 'none';
        document.getElementById('product-container').style.display = 'block';
    }

    loadDetails();
</script>
</body>
</html>
